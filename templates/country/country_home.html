{% extends "base.html" %}
{% load static %}
{% block content %}
  
  {{ records|json_script:"records_dict" }}   
  {% include "navbar.html" %}

  <main role="main" class="container-fluid p-0 mx-auto" style="max-width:500px">
    <div class="mt-5"> </div>
    <div>
      <div class="lead">{{ country }}</div>        
    </div>
    
    <!-- plotly -->
    <div class="card card-body shadow">
      <div class="row">
        <div class="col-12">      
          <iframe frameBorder="0" style="width:100%;height:370px" srcdoc='{{div_html|escape}}'></iframe>
        </div> <!-- /col-12 -->
      </div> <!-- /row -->
    </div> <!-- /card-->
    
    <br>
    <div class="card card-body shadow">
      <div class="row">
        <div class="col-12">      
          <table id="table-country-records" class="table table-sm no-footer display" 
            cellspacing="0" width="100%" >
            <thead>
              <tr class="text-left">
                <td class="compact">State</td>
                <td class="compact">Confirmed</td>
                <td class="compact">Recovered</td>
                <td class="compact">Deaths</td>
              </tr>
            </thead>
            <tbody></tbody>
          </table> 
        </div> <!-- /col-12 -->
      </div> <!-- /row -->
    </div> <!-- /card-->
  </main>  
  
  <script src="{% static 'js/jquery-3.2.1.js' %}" ></script>
  <script src="{% static 'js/jquery.dataTables.1.10.20.js' %}"></script>  
  <script>
    $(function() {
      handleRecordsTable();
    });
    
    function handleRecordsTable(){
      var records = JSON.parse(
        document.
        getElementById('records_dict').
        textContent);
      var table = $('#table-country-records').DataTable({
        "columns": [
          { className: "compact"},
          { className: "text-right text-warning compact"},
          { className: "text-right text-success compact"},
          { className: "text-right text-danger compact"}
        ],
        "stripeClasses": [],
        "info": false,      
        "order": [[ 1, "desc" ]],
        "paging": false,
        "scrollY": "180px"
      });
      $('.dataTables_filter input').addClass('dataTableSearch');
      $.each(records, function(state_province, record){
        if (state_province == ""){
          state_province = 'No data';
        }
        confirmed_count = record.confirmed.latest_stats_value;
        recovered_count = record.recovered.latest_stats_value;
        deceased_count  = record.deaths.latest_stats_value;
        table.row.add(
          [
            state_province, 
            confirmed_count,
            recovered_count,
            deceased_count
          ]).draw();
      }); 
    }
  </script>
{% endblock content %}
