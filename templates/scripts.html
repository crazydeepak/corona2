{% load static %}
  
  <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.2/Chart.min.js'></script>
  <script type='text/javascript' src='https://d3js.org/d3.v3.min.js'></script>
  <script type='text/javascript' src='https://d3js.org/topojson.v1.min.js'></script>
  <script type='text/javascript' src='https://cdn.rawgit.com/BinaryMuse/planetary.js/v1.1.2/dist/planetaryjs.min.js'></script>  
  <script type='text/javascript' src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
  <script type='text/javascript' src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script type='text/javascript' src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
  <script type='text/javascript' src="{% static 'js/jquery.timeago.js' %}"></script>
  <script type='text/javascript' src="{% static 'js/sparklines.js' %}"></script>
  <script type='text/javascript' src="{% static 'js/jquery.sparkline.js' %}" type="text/javascript"></script>
  <script type='text/javascript' src="{% static 'js/sparkline-chart.js' %}"></script>
  <script type='text/javascript' src="{% static 'js/jquery.scrollTo.min.js' %}"></script>
  <script type='text/javascript' src="{% static 'js/jquery.nicescroll.js' %}" type="text/javascript"></script>
  <script type='text/javascript' src="{% static 'js/jquery.slimscroll.min.js' %}"></script>
  <!-- <script type='text/javascript' src="{% static 'assets/chart-master/Chart.js' %}"></script> -->

  <script>
    $(function() {
      
      var cntry = {"AFG":"Afghanistan","ALB":"Albania","DZA":"Algeria","AND":"Andorra","AGO":"Angola","ATG":"AntiguaandBarbuda","ARG":"Argentina","ARM":"Armenia","AUS":"Australia","AUT":"Austria","AZE":"Azerbaijan","BHS":"Bahamas","BHR":"Bahrain","BGD":"Bangladesh","BRB":"Barbados","BLR":"Belarus","BEL":"Belgium","BLZ":"Belize","BEN":"Benin","BTN":"Bhutan","BOL":"Bolivia(PlurinationalStateof)","BIH":"BosniaandHerzegovina","BWA":"Botswana","BRA":"Brazil","BRN":"BruneiDarussalam","BGR":"Bulgaria","BFA":"BurkinaFaso","BDI":"Burundi","CPV":"CaboVerde","KHM":"Cambodia","CMR":"Cameroon","CAN":"Canada","CAF":"CentralAfricanRepublic","TCD":"Chad","CHL":"Chile","CHN":"China","COL":"Colombia","COM":"Comoros","COG":"Congo","COD":"Congo,DemocraticRepublicofthe","CRI":"CostaRica","CIV":"Côted'Ivoire","HRV":"Croatia","CUB":"Cuba","CYP":"Cyprus","CZE":"Czechia","DNK":"Denmark","DJI":"Djibouti","DMA":"Dominica","DOM":"DominicanRepublic","ECU":"Ecuador","EGY":"Egypt","SLV":"ElSalvador","GNQ":"EquatorialGuinea","ERI":"Eritrea","EST":"Estonia","SWZ":"Eswatini","ETH":"Ethiopia","FJI":"Fiji","FIN":"Finland","FRA":"France","GAB":"Gabon","GMB":"Gambia","GEO":"Georgia","DEU":"Germany","GHA":"Ghana","GRC":"Greece","GRD":"Grenada","GTM":"Guatemala","GIN":"Guinea","GNB":"Guinea-Bissau","GUY":"Guyana","HTI":"Haiti","HND":"Honduras","HUN":"Hungary","ISL":"Iceland","IND":"India","IDN":"Indonesia","IRN":"Iran(IslamicRepublicof)","IRQ":"Iraq","IRL":"Ireland","ISR":"Israel","ITA":"Italy","JAM":"Jamaica","JPN":"Japan","JOR":"Jordan","KAZ":"Kazakhstan","KEN":"Kenya","KIR":"Kiribati","PRK":"Korea(DemocraticPeople'sRepublicof)","KOR":"Korea,Republicof","KWT":"Kuwait","KGZ":"Kyrgyzstan","LAO":"LaoPeople'sDemocraticRepublic","LVA":"Latvia","LBN":"Lebanon","LSO":"Lesotho","LBR":"Liberia","LBY":"Libya","LIE":"Liechtenstein","LTU":"Lithuania","LUX":"Luxembourg","MDG":"Madagascar","MWI":"Malawi","MYS":"Malaysia","MDV":"Maldives","MLI":"Mali","MLT":"Malta","MHL":"MarshallIslands","MRT":"Mauritania","MUS":"Mauritius","MEX":"Mexico","FSM":"Micronesia(FederatedStatesof)","MDA":"Moldova,Republicof","MCO":"Monaco","MNG":"Mongolia","MNE":"Montenegro","MAR":"Morocco","MOZ":"Mozambique","MMR":"Myanmar","NAM":"Namibia","NRU":"Nauru","NPL":"Nepal","NLD":"Netherlands","NZL":"NewZealand","NIC":"Nicaragua","NER":"Niger","NGA":"Nigeria","MKD":"NorthMacedonia","NOR":"Norway","OMN":"Oman","PAK":"Pakistan","PLW":"Palau","PAN":"Panama","PNG":"PapuaNewGuinea","PRY":"Paraguay","PER":"Peru","PHL":"Philippines","POL":"Poland","PRT":"Portugal","QAT":"Qatar","ROU":"Romania","RUS":"RussianFederation","RWA":"Rwanda","KNA":"SaintKittsandNevis","LCA":"SaintLucia","VCT":"SaintVincentandtheGrenadines","WSM":"Samoa","SMR":"SanMarino","STP":"SaoTomeandPrincipe","SAU":"SaudiArabia","SEN":"Senegal","SRB":"Serbia","SYC":"Seychelles","SLE":"SierraLeone","SGP":"Singapore","SVK":"Slovakia","SVN":"Slovenia","SLB":"SolomonIslands","SOM":"Somalia","ZAF":"SouthAfrica","SSD":"SouthSudan","ESP":"Spain","LKA":"SriLanka","SDN":"Sudan","SUR":"Suriname","SWE":"Sweden","CHE":"Switzerland","SYR":"SyrianArabRepublic","TJK":"Tajikistan","TZA":"Tanzania,UnitedRepublicof","THA":"Thailand","TLS":"Timor-Leste","TGO":"Togo","TON":"Tonga","TTO":"TrinidadandTobago","TUN":"Tunisia","TUR":"Turkey","TKM":"Turkmenistan","TUV":"Tuvalu","UGA":"Uganda","UKR":"Ukraine","ARE":"UnitedArabEmirates","GBR":"UnitedKingdomofGreatBritainandNorthernIreland","USA":"UnitedStatesofAmerica","URY":"Uruguay","UZB":"Uzbekistan","VUT":"Vanuatu","VEN":"Venezuela(BolivarianRepublicof)","VNM":"VietNam","YEM":"Yemen","ZMB":"Zambia","ZWE":"Zimbabwe"};
      
      var summary = JSON.parse(document.getElementById('summary-data').textContent);
      jQuery("time.timeago").timeago();
      
      $("#lastrefreshed").text(jQuery.timeago(summary.utc_dt));
      
      var offset = moment().utcOffset();
      var localText = moment.utc(summary.utc_dt).utcOffset(offset).format("L LT");
      handleCollapsibleCountSection();
      handleCountDataTable(summary,cntry);
      handleSparks(summary);
      handleGlobe();


      console.log("beep")
      var lineChartData = {
          labels : ["a","b","c","d","e","f","g"],
          datasets : [
            {
                fillColor : "rgba(220,220,220,0.5)",
                strokeColor : "rgba(220,220,220,1)",
                pointColor : "rgba(220,220,220,1)",
                pointStrokeColor : "#fff",
                data : [65,59,90,81,56,55,40]
            },
            {
                fillColor : "rgba(151,187,205,0.5)",
                strokeColor : "rgba(151,187,205,1)",
                pointColor : "rgba(151,187,205,1)",
                pointStrokeColor : "#fff",
                data : [28,48,40,19,96,27,100]
            }
        ]
      };
      new Chart(document.getElementById("line").getContext("2d")).Line(lineChartData);



    });

    function handleCollapsibleCountSection(){
      // Collapsible section 
      $(".collapse.show").each(function(){
        $(this).prev(".card-header").find(".fa").addClass("fa-angle-up").removeClass("fa-angle-right");
      });
      // Toggle right minus icon on show hide of collapse element
      $(".collapse").on('show.bs.collapse', function(){
      	$(this).prev(".card-header").find(".fa").removeClass("fa-angle-right").addClass("fa-angle-up");
      }).on('hide.bs.collapse', function(){
      	$(this).prev(".card-header").find(".fa").removeClass("fa-angle-up").addClass("fa-angle-right");
      });
    }

    function handleCountDataTable(summary,cntry){
      var cntry = {"AFG":"Afghanistan","ALB":"Albania","DZA":"Algeria","AND":"Andorra","AGO":"Angola","ATG":"Antigua and Barbuda","ARG":"Argentina","ARM":"Armenia","AUS":"Australia","AUT":"Austria","AZE":"Azerbaijan","BHS":"Bahamas","BHR":"Bahrain","BGD":"Bangladesh","BRB":"Barbados","BLR":"Belarus","BEL":"Belgium","BLZ":"Belize","BEN":"Benin","BTN":"Bhutan","BOL":"Bolivia (Plurinational State of)","BIH":"Bosnia and Herzegovina","BWA":"Botswana","BRA":"Brazil","BRN":"Brunei Darussalam","BGR":"Bulgaria","BFA":"Burkina Faso","BDI":"Burundi","CPV":"Cabo Verde","KHM":"Cambodia","CMR":"Cameroon","CAN":"Canada","CAF":"Central African Republic","TCD":"Chad","CHL":"Chile","CHN":"China","COL":"Colombia","COM":"Comoros","COG":"Congo","COD":"Congo, Democratic Republic of the","CRI":"Costa Rica","CIV":"Côte d'Ivoire","HRV":"Croatia","CUB":"Cuba","CYP":"Cyprus","CZE":"Czechia","DNK":"Denmark","DJI":"Djibouti","DMA":"Dominica","DOM":"Dominican Republic","ECU":"Ecuador","EGY":"Egypt","SLV":"El Salvador","GNQ":"Equatorial Guinea","ERI":"Eritrea","EST":"Estonia","SWZ":"Eswatini","ETH":"Ethiopia","FJI":"Fiji","FIN":"Finland","FRA":"France","GAB":"Gabon","GMB":"Gambia","GEO":"Georgia","DEU":"Germany","GHA":"Ghana","GRC":"Greece","GRD":"Grenada","GTM":"Guatemala","GIN":"Guinea","GNB":"Guinea-Bissau","GUY":"Guyana","HTI":"Haiti","HND":"Honduras","HUN":"Hungary","ISL":"Iceland","IND":"India","IDN":"Indonesia","IRN":"Iran (Islamic Republic of)","IRQ":"Iraq","IRL":"Ireland","ISR":"Israel","ITA":"Italy","JAM":"Jamaica","JPN":"Japan","JOR":"Jordan","KAZ":"Kazakhstan","KEN":"Kenya","KIR":"Kiribati","PRK":"Korea (Democratic People's Republic of)","KOR":"Korea, Republic of","KWT":"Kuwait","KGZ":"Kyrgyzstan","LAO":"Lao People's Democratic Republic","LVA":"Latvia","LBN":"Lebanon","LSO":"Lesotho","LBR":"Liberia","LBY":"Libya","LIE":"Liechtenstein","LTU":"Lithuania","LUX":"Luxembourg","MDG":"Madagascar","MWI":"Malawi","MYS":"Malaysia","MDV":"Maldives","MLI":"Mali","MLT":"Malta","MHL":"Marshall Islands","MRT":"Mauritania","MUS":"Mauritius","MEX":"Mexico","FSM":"Micronesia (Federated States of)","MDA":"Moldova, Republic of","MCO":"Monaco","MNG":"Mongolia","MNE":"Montenegro","MAR":"Morocco","MOZ":"Mozambique","MMR":"Myanmar","NAM":"Namibia","NRU":"Nauru","NPL":"Nepal","NLD":"Netherlands","NZL":"New Zealand","NIC":"Nicaragua","NER":"Niger","NGA":"Nigeria","MKD":"North Macedonia","NOR":"Norway","OMN":"Oman","PAK":"Pakistan","PLW":"Palau","PAN":"Panama","PNG":"Papua New Guinea","PRY":"Paraguay","PER":"Peru","PHL":"Philippines","POL":"Poland","PRT":"Portugal","QAT":"Qatar","ROU":"Romania","RUS":"Russian Federation","RWA":"Rwanda","KNA":"Saint Kitts and Nevis","LCA":"Saint Lucia","VCT":"Saint Vincent and the Grenadines","WSM":"Samoa","SMR":"San Marino","STP":"Sao Tome and Principe","SAU":"Saudi Arabia","SEN":"Senegal","SRB":"Serbia","SYC":"Seychelles","SLE":"Sierra Leone","SGP":"Singapore","SVK":"Slovakia","SVN":"Slovenia","SLB":"Solomon Islands","SOM":"Somalia","ZAF":"South Africa","SSD":"South Sudan","ESP":"Spain","LKA":"Sri Lanka","SDN":"Sudan","SUR":"Suriname","SWE":"Sweden","CHE":"Switzerland","SYR":"Syrian Arab Republic","TJK":"Tajikistan","TZA":"Tanzania, United Republic of","THA":"Thailand","TLS":"Timor-Leste","TGO":"Togo","TON":"Tonga","TTO":"Trinidad and Tobago","TUN":"Tunisia","TUR":"Turkey","TKM":"Turkmenistan","TUV":"Tuvalu","UGA":"Uganda","UKR":"Ukraine","ARE":"United Arab Emirates","GBR":"United Kingdom","USA":"United States of America","URY":"Uruguay","UZB":"Uzbekistan","VUT":"Vanuatu","VEN":"Venezuela (Bolivarian Republic of)","VNM":"Viet Nam","YEM":"Yemen","ZMB":"Zambia","ZWE":"Zimbabwe"};
      var table = $('#table-count').DataTable({
        "columns": [
          { className: "dummy"},
          { className: "orange"},
          { className: "darkred"},
          { className: "green"}
        ],
        "info": false,      
        "order": [[ 1, "desc" ]],
        "paging": false,
      });
      $.each( summary.countriesSorted_Confirmed, function(index, alpha3){
        if(alpha3 in cntry){
            country = cntry[alpha3];
        } else {
            country = alpha3;
        }
        var href_country = 
        '<a href="/country/' + alpha3 + '">' + 
            country + 
        '</a>';
        console.log(href_country)
            
        // country = value;
        confirmed = summary.countries[alpha3].confirmed;
        recovered = summary.countries[alpha3].recovered;
        deaths    = summary.countries[alpha3].deaths;
        table.row.add([href_country, confirmed, deaths, recovered]).draw();
      });      
    }

    function handleSparks(summary) {
      $('#spark-confirmed').sparkline(summary.trend_confirmed, {height: 40,width: '100%',lineWidth: 2,fillColor: false,lineColor: "orange",spotColor: 'orange',spotRadius: 2});
      $('#spark-recovered').sparkline(summary.trend_recovered, {height: 40,width: '100%',fillColor: false,lineColor: "#26c281",spotColor: '#26c281',spotRadius: 2,lineWidth: 2});
      $('#spark-deaths').sparkline(summary.trend_deaths,       {height: 40,width: '100%',fillColor: false,lineColor: "tomato",spotColor: 'tomato',spotRadius: 2,lineWidth: 2});
      $("#recovered-count").text(summary.totals.total_recovered.toLocaleString())
      $("#confirmed-count").text(summary.totals.total_confirmed.toLocaleString())
      $("#deaths-count").text(summary.totals.total_deaths.toLocaleString())
    }
  
    function handleGlobe(){
      var arr = JSON.parse(document.getElementById('hello-data').textContent);
      var planet = planetaryjs.planet();
      
      planet.loadPlugin(planetaryjs.plugins.earth({
        topojson: { file: 'https://raw.githubusercontent.com/BinaryMuse/planetary.js/v1.1.2/dist/world-110m.json' },
        land:     { fill:   '#4CAF50' },
        oceans:   { fill:   '#aad3df' },
        borders:  { stroke: '#1B5E20' }
      }));
      // Load our custom autorotate plugin
      planet.loadPlugin(autorotate(10));
      // Load the `pings` plugin to draw animated pings on the globe
      planet.loadPlugin(
        planetaryjs.plugins.pings({
          color: 'tomato', 
          ttl: 2000, 
          angle: 1
        })
      );
      planet.loadPlugin(planetaryjs.plugins.zoom({
        scaleExtent: [100, 500]
      }));
      planet.loadPlugin(planetaryjs.plugins.drag({
        // Dragging the globe should pause the
        // automatic rotation until we release the mouse.
        onDragStart: function() {
          this.plugins.autorotate.pause();
        },
        onDragEnd: function() {
          this.plugins.autorotate.resume();
        }
      }));
      // Make the planet fit well in its canvas
      planet.projection.scale(175).translate([175, 175]);
      var canvas = document.getElementById('globe');
      planet.draw(canvas);

      // This plugin will automatically rotate the globe around its vertical
      // axis a configured number of degrees every second.
      function autorotate(degPerSec) {
        // Planetary.js plugins are functions that take a `planet` instance as an argument...
        return function(planet) {
          var lastTick = null;
          var paused = false;
          planet.plugins.autorotate = {
            pause:  function() { paused = true;  },
            resume: function() { paused = false; }
          };
          // ...and configure hooks into certain pieces of its lifecycle.
          planet.onDraw(function() {
            if (paused || !lastTick) {
              lastTick = new Date();
            } else {
              var now = new Date();
              var delta = now - lastTick;
              // This plugin uses the built-in projection (provided by D3) to rotate the globe each time we draw it.
              var rotation = planet.projection.rotate();
              rotation[0] += degPerSec * delta / 1000;
              if (rotation[0] >= 180) rotation[0] -= 360;
              planet.projection.rotate(rotation);
              lastTick = now;
            }
          });
        };
      };

      setInterval(function() {
        for (var i = 0; i < arr.length; i++){
          var obj = arr[i];
          lng = obj.longitude;
          lat = obj.latitude;
          latestDeathCount = obj.latest_stats_value;
          computedAngle = latestDeathCount/1000;
          if (computedAngle < 2){ computedAngle = 2}
          if (computedAngle > 5){ computedAngle = 5}
          planet.plugins.pings.add(lng, lat, { color: 'red', ttl: 1000, angle: computedAngle});
        }
      }, 1000);
    }

  </script>